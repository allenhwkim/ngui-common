!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs")):"function"==typeof define&&define.amd?define("@ngui/common",["exports","@angular/core","@angular/common","rxjs"],t):t(((e=e||self).ngui=e.ngui||{},e.ngui.common={}),e.ng.core,e.ng.common,e.rxjs)}(this,(function(e,t,n,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function s(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var p=e.length-1;p>=0;p--)(o=e[p])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r}function r(e,t){return function(n,i){t(n,i,e)}}function p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}Object.create;Object.create;var c=function(){function e(e,n){this.element=e,this.platformId=n,this.observerOptions={threshold:[.1,.2,.3,.4,.5,.6,.7,.8]},this.blurEnabled=!0,this.inview=new t.EventEmitter,this.notInview=new t.EventEmitter,this.isInview=!1,this.once80PctVisible=!1}return e.prototype.ngOnInit=function(){this.options&&(this.observerOptions=this.options),n.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.observerOptions),this.observer.observe(this.element.nativeElement))},e.prototype.ngOnDestroy=function(){this.observer.disconnect()},e.prototype.handleIntersect=function(e){var t=this;e.forEach((function(e){e.isIntersecting?(t.isInview=!0,t.defaultInviewHandler(e),t.inview.emit(e)):t.notInview.emit(e)}))},e.prototype.defaultInviewHandler=function(e){if(this.blurEnabled&&!this.once80PctVisible&&!this.inview.observers.length)if(e.intersectionRatio<.8){var t=1.25*e.intersectionRatio,n="blur("+(20-4*Math.floor(10*e.intersectionRatio))+"px)";Object.assign(e.target.style,{opacity:t,filter:n})}else e.target.style.opacity=1,e.target.style.filter="unset",this.once80PctVisible=!0},e.ctorParameters=function(){return[{type:t.ElementRef},{type:void 0,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},s([t.ContentChild(t.TemplateRef,{static:!0}),p("design:type",t.TemplateRef)],e.prototype,"template",void 0),s([t.Input(),p("design:type",Object)],e.prototype,"observerOptions",void 0),s([t.Input(),p("design:type",Object)],e.prototype,"options",void 0),s([t.Input(),p("design:type",Object)],e.prototype,"blurEnabled",void 0),s([t.Output(),p("design:type",t.EventEmitter)],e.prototype,"inview",void 0),s([t.Output(),p("design:type",t.EventEmitter)],e.prototype,"notInview",void 0),e=s([t.Component({selector:"ngui-inview",template:'\n        <ng-container *ngIf="isInview" [ngTemplateOutlet]="template">\n        </ng-container>\n    ',styles:[":host {display: block;}"]}),r(1,t.Inject(t.PLATFORM_ID)),p("design:paramtypes",[t.ElementRef,Object])],e)}(),a=function(){function e(e,n){this.element=e,this.platformId=n,this.observerOptions={threshold:[.1,.2,.3,.4,.5,.6,.7,.8]},this.nguiInview=new t.EventEmitter,this.nguiOutview=new t.EventEmitter}return e.prototype.ngOnInit=function(){this.options&&(this.observerOptions=this.options),n.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.observerOptions),this.observer.observe(this.element.nativeElement))},e.prototype.ngOnDestroy=function(){n.isPlatformBrowser(this.platformId)&&this.observer&&this.observer.disconnect()},e.prototype.handleIntersect=function(e){var t=this;e.forEach((function(e){e.isIntersecting?t.nguiInview.emit(e):t.nguiOutview.emit(e)}))},e.ctorParameters=function(){return[{type:t.ElementRef},{type:void 0,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},s([t.Input(),p("design:type",Object)],e.prototype,"observerOptions",void 0),s([t.Input(),p("design:type",Object)],e.prototype,"options",void 0),s([t.Output(),p("design:type",t.EventEmitter)],e.prototype,"nguiInview",void 0),s([t.Output(),p("design:type",t.EventEmitter)],e.prototype,"nguiOutview",void 0),e=s([t.Directive({selector:"[nguiInview], [nguiOutview]"}),r(1,t.Inject(t.PLATFORM_ID)),p("design:paramtypes",[t.ElementRef,Object])],e)}(),u=function(){function e(){}return e=s([t.NgModule({imports:[n.CommonModule],declarations:[c,a],exports:[c,a]})],e)}();function l(e,t,n){var i;return void 0===n&&(n={}),"click"===t||t.match(/^mouse/)?i=new MouseEvent(t,n):t.match(/^key/)?i=new KeyboardEvent(t,n):t.match(/^touch/)&&(i=new TouchEvent(t,n)),e.dispatchEvent(i)}var d=function(){function e(e){this.factoryResolver=e}return e.prototype.createComponent=function(e,t){return this.rootViewContainer=t||this.rootViewContainer,this.factoryResolver.resolveComponentFactory(e).create(this.rootViewContainer.parentInjector)},e.prototype.insertComponent=function(e){var t="ngui-dyn-"+(Math.floor(Math.random()*Math.pow(10,7))+Math.pow(10,6));return e.location.nativeElement.setAttribute("id",t),e.instance.id=t,this.rootViewContainer.insert(e.hostView),e.instance},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[t.ComponentFactoryResolver]}]}]},e=s([t.Injectable(),r(0,t.Inject(t.ComponentFactoryResolver)),p("design:paramtypes",[Object])],e)}(),h=function(){function e(e,t,n){this.element=e,this.renderer=t,this.cdRef=n,this.outView=!1,this.itemsBackup=[]}return e.prototype.restoreItems=function(){this.outView&&(this.outView=!1,this.items=Array.from(this.itemsBackup||[]),this.itemsBackup=void 0,this.renderer.setStyle(this.contentsEl,"height",void 0),this.cdRef.detectChanges())},e.prototype.ngOnInit=function(){this.contentsEl=this.element.nativeElement.querySelector(".inview-page.contents")},e.prototype.ngOnDestroy=function(){console.log("NguiInviewPageComponent.ngOnDestroy() is called"),this.destroyed=!0},e.prototype.emptyItems=function(){if(this.items&&this.contentsEl&&!this.outView){var e=this.element.nativeElement.getBoundingClientRect().height;this.renderer.setStyle(this.contentsEl,"height",e+"px"),this.outView=!0,this.itemsBackup=Array.from(this.items||[]),this.items=void 0,this.destroyed||this.cdRef.detectChanges()}},e.prototype.setItems=function(e){this.destroyed||(console.log("NguiInviewPageComponent.setItems() is called with",e),this.items=e,this.cdRef.detectChanges())},e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2},{type:t.ChangeDetectorRef}]},s([t.ContentChild(t.TemplateRef,{static:!0}),p("design:type",t.TemplateRef)],e.prototype,"template",void 0),s([t.Input(),p("design:type",Array)],e.prototype,"items",void 0),e=s([t.Component({selector:"ngui-inview-page",template:'\n    <div class="inview-page contents"\n      (nguiInview)="restoreItems()"\n      (nguiOutview)="emptyItems()">\n      \x3c!-- add blank ngui-list-item by condition  --\x3e\n      \x3c!-- no match found ngui-list-item by condition --\x3e\n      <ng-container\n        [ngTemplateOutlet]="template||defaultTemplate"\n        [ngTemplateOutletContext]="{items: items, outView: outView}">\n      </ng-container>\n      <div *ngIf="outView">{{ itemsBackup.length }} items hidden</div>\n    </div>\n\n    <ng-template #defaultTemplate>\n      <div *ngIf="!items"> Error: requires [items] </div>\n      <div *ngIf="!template"> Error: requires &lt;ng-template></div>\n    </ng-template>\n  ',styles:["\n    :host {display: block}\n  "]}),p("design:paramtypes",[t.ElementRef,t.Renderer2,t.ChangeDetectorRef])],e)}(),m=function(){function e(e,n,i,o){this.renderer=e,this.element=n,this.dynamicComponentService=i,this.cdr=o,this.selected=new t.EventEmitter,this.escaped=new t.EventEmitter,this.bottomInview=new t.EventEmitter,this._focused=!1,this.inviewPages=[]}return e.prototype.ngAfterViewInit=function(){this.template&&this.bottomInview.observers.length||console.error("<ngui-virtual-list> requires [template] and {bottomInview)")},e.prototype.addAnInviewPageToPages=function(){this.isListLoading?console.log("Already a page being inserted, skipping adding a page"):(this.isListLoading=!0,this.inviewPage=this.dynamicComponentService.createComponent(h,this.pagesRef),this.dynamicComponentService.insertComponent(this.inviewPage),this.inviewPage.instance.template=this.template,this.inviewPages.push(this.inviewPage),this.bottomInview.emit(this))},e.prototype.addList=function(e){this.isListLoading=!1,console.log(">>>>>> NguiVirtualListComponent.addList() is called()"),this.inviewPage.instance.setItems(e)},e.ctorParameters=function(){return[{type:t.Renderer2},{type:t.ElementRef},{type:d},{type:t.ChangeDetectorRef}]},s([t.ViewChild("pages",{read:t.ViewContainerRef,static:!1}),p("design:type",t.ViewContainerRef)],e.prototype,"pagesRef",void 0),s([t.ContentChild(t.TemplateRef,{static:!1}),p("design:type",t.TemplateRef)],e.prototype,"template",void 0),s([t.Output(),p("design:type",t.EventEmitter)],e.prototype,"selected",void 0),s([t.Output(),p("design:type",t.EventEmitter)],e.prototype,"escaped",void 0),s([t.Output(),p("design:type",t.EventEmitter)],e.prototype,"bottomInview",void 0),e=s([t.Component({selector:"ngui-virtual-list",template:'\n    <div class="ngui-virtual-list"\n      (focus)="_focused = true"\n      (click)="_focused = true">\n      \x3c!-- hold multiple <ngui-inview-page> --\x3e\n      <div #pages></div>\n      \x3c!-- insert <ngui-inview-page> into #pages --\x3e\n      <ngui-inview (inview)="addAnInviewPageToPages()"></ngui-inview>\n    </div>\n  ',styles:["\n    :host {display: block}\n  "]}),p("design:paramtypes",[t.Renderer2,t.ElementRef,d,t.ChangeDetectorRef])],e)}(),g=function(){this.html="No Match Found"},v=function(){this.html="Select"},f=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.minInputChars=1,t.blankOption="Select One",t.noMatchItem="No Match Found",t._focused={input:!1,listItem:!1},t}return function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(n,e),Object.defineProperty(n.prototype,"isReady",{get:function(){var e=this._selectedFromList||this._escapedFromList,t=this._focused.input||this._focused.listItem,n=this.inputEl.value.length>=this.minInputChars;return!e&&t&&n},enumerable:!0,configurable:!0}),n.prototype.ngOnInit=function(){this.inputEl=document.querySelector("#"+this.for),this.positionThisUnderInputEl(),i.fromEvent(this.inputEl,"keyup").subscribe(this.onInputElKeyup.bind(this)),this.inputEl.addEventListener("focus",this.onInputElFocused.bind(this)),this.inputEl.addEventListener("blur",this.onInputElBlurred.bind(this)),this.selected.subscribe(this.onSelected.bind(this)),this.escaped.subscribe(this.onEscaped.bind(this))},n.prototype.onSelected=function(e){this._selectedFromList=!0,this.inputEl.focus(),this._lastSelected=e,this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onSelected() is called",e)},n.prototype.onEscaped=function(){this._escapedFromList=!0,this.inputEl.focus(),this._lastSelected||(this.inputEl.value=this._orgInputValue),this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onEscaped() is called")},n.prototype.onInputElFocused=function(e){console.log("NguiAutoCompleteComponent.onInputElFocused() is called",e),this.isListLoading=!1,void 0===this._orgInputValue&&(this._orgInputValue=this.inputEl.value),this._prevInputValue=this.inputEl.value,this.setFocused("input",!0)},n.prototype.onInputElBlurred=function(){this.setFocused("input",!1)},n.prototype.clearList=function(){this.inviewPages.forEach((function(e){e.destroy()})),this.inviewPages=[]},n.prototype.onInputElKeyup=function(e){console.log("NguiAutoCompleteComponent.onInputKeyup() is called",e.key);var t=this.element.nativeElement.querySelector("ngui-list-item");"Enter"===e.key||"Escape"===e.key?t?l(t,"keyup",{key:e.key}):this.onEscaped():"ArrowDown"!==e.key&&"ArrowRight"!==e.key||!t?"ArrowUp"===e.key||"ArrowLeft"===e.key||this.inputEl.value.length>=this.minInputChars&&(this._selectedFromList=!1,this._escapedFromList=!1,this.addAutocompleteList()):t.focus()},n.prototype.addAutocompleteList=function(){var e=this;this.isReady&&(clearTimeout(this._acTimer),this._acTimer=setTimeout((function(){e.isListLoading=!1,e._prevInputValue=e.inputEl.value,e._escapedFromList=!1,e._selectedFromList=!1,e.clearList(),e.addAnInviewPageToPages()}),200))},n.prototype.addMorePages=function(){this.inviewPages.length&&this.addAnInviewPageToPages()},n.prototype.setFocused=function(e,t){var n=this;t?(clearTimeout(this._focusTimer),this._focused={input:!1,listItem:!1},this._focused[e]=!0):this._focusTimer=setTimeout((function(){n._focused[e]=!1,n.cdr.detectChanges()}),100)},n.prototype.positionThisUnderInputEl=function(){var e=this.element.nativeElement,t=this.inputEl.getBoundingClientRect(),n=t.top+t.height+window.scrollY;this.renderer.setStyle(e,"left",t.left+"px"),this.renderer.setStyle(e,"top",n+"px"),this.renderer.setStyle(e,"minWidth",t.width+"px")},n.prototype.addList=function(e){var t;console.log(">>>>>> NguiAutocompleteComponent.addList() is called()"),this.isListLoading=!1;var n={};1===this.inviewPages.length&&(!this.noMatchItem||e&&0!==e.length?this.blankOption&&((n=new v).html=this.blankOption):(t=new g,n.html=this.noMatchItem));var i=[].concat(t,n,e).filter((function(e){return e}));this.inviewPage.instance.setItems(i),this.cdr.detectChanges()},s([t.Input(),p("design:type",String)],n.prototype,"for",void 0),s([t.Input(),p("design:type",Object)],n.prototype,"minInputChars",void 0),s([t.Input(),p("design:type",Object)],n.prototype,"blankOption",void 0),s([t.Input(),p("design:type",Object)],n.prototype,"noMatchItem",void 0),s([t.ContentChild(t.TemplateRef,{static:!1}),p("design:type",t.TemplateRef)],n.prototype,"template",void 0),n=s([t.Component({selector:"ngui-autocomplete",template:'\n    <div *ngIf="isReady" class="ngui-autocomplete">\n      <div #pages></div>\n      <ngui-inview (inview)="addMorePages()"></ngui-inview>\n    </div>\n  ',styles:["\n    :host {position: absolute; background-color: #fff; max-height: 300px; overflow: auto}\n    .ngui-autocomplete { border: 1px solid #ccc; padding: 4px }\n  "]})],n)}(m),y=function(){function e(e){this.element=e,this.selected=new t.EventEmitter,this.escaped=new t.EventEmitter}return e.ctorParameters=function(){return[{type:t.ElementRef}]},s([t.Output(),p("design:type",t.EventEmitter)],e.prototype,"selected",void 0),s([t.Output(),p("design:type",t.EventEmitter)],e.prototype,"escaped",void 0),e=s([t.Directive({selector:"ngui-list"}),p("design:paramtypes",[t.ElementRef])],e)}(),w=function(){function e(e,t,n,i,o,s){this.el=e,this.renderer=t,this.viewContainer=n,this.listDirective=i,this.virtualListComponent=o,this.autocompleteComponent=s}return e.prototype.ngOnInit=function(){if(this.renderer.setAttribute(this.el.nativeElement,"tabindex","0"),this.parentListComp=this.listDirective||this.virtualListComponent||this.autocompleteComponent,!this.parentListComp)throw Error("ngui-list-item requires parent of ngui-list, ngui-virtual-list, or ngui-autocomplete.");(this.object instanceof v||this.object instanceof g)&&(this.viewContainer.clear(),this.el.nativeElement.innerHTML=this.object.html)},e.prototype.keydown=function(e){var t=this.el.nativeElement,n=e.which||e.keyCode,i=this.parentListComp.element.nativeElement,o=Array.from(i.querySelectorAll("ngui-list-item")),s=o.indexOf(t),r=o[s+1]||o[0],p=o[s-1]||o[o.length-1];switch(n){case 37:case 38:p.focus();break;case 39:case 40:r.focus()}},e.prototype.keyup=function(e){switch(e.key){case"Enter":this.parentListComp.selected.emit(this.object);break;case"Escape":this.parentListComp.escaped.emit()}},e.prototype.mousedown=function(){this.parentListComp.selected.emit(this.object)},e.prototype.focused=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!0)},e.prototype.blurred=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!1)},e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2},{type:t.ViewContainerRef},{type:y,decorators:[{type:t.Optional},{type:t.Host}]},{type:m,decorators:[{type:t.Optional},{type:t.Host}]},{type:f,decorators:[{type:t.Optional},{type:t.Host}]}]},s([t.Input("item"),p("design:type",Object)],e.prototype,"object",void 0),s([t.HostListener("keydown",["$event"]),p("design:type",Function),p("design:paramtypes",[Object]),p("design:returntype",void 0)],e.prototype,"keydown",null),s([t.HostListener("keyup",["$event"]),p("design:type",Function),p("design:paramtypes",[Object]),p("design:returntype",void 0)],e.prototype,"keyup",null),s([t.HostListener("click",["$event"]),p("design:type",Function),p("design:paramtypes",[]),p("design:returntype",void 0)],e.prototype,"mousedown",null),s([t.HostListener("focus",["$event"]),p("design:type",Function),p("design:paramtypes",[]),p("design:returntype",void 0)],e.prototype,"focused",null),s([t.HostListener("blur",["$event"]),p("design:type",Function),p("design:paramtypes",[]),p("design:returntype",void 0)],e.prototype,"blurred",null),e=s([t.Directive({selector:"ngui-list-item"}),r(3,t.Optional()),r(3,t.Host()),r(4,t.Optional()),r(4,t.Host()),r(5,t.Optional()),r(5,t.Host()),p("design:paramtypes",[t.ElementRef,t.Renderer2,t.ViewContainerRef,y,m,f])],e)}(),E=function(){function e(){}return e=s([t.NgModule({imports:[n.CommonModule,u],declarations:[f,h,y,w,m],exports:[f,h,y,w,m],entryComponents:[h]})],e)}(),I=function(){function e(){}return e.prototype.transform=function(e,t){var n=e;if(t){var i=new RegExp(t,"ig");n=e.replace(i,(function(e){return'<span class="ngui-highlight">'+e+"</span>"}))}return n},e=s([t.Pipe({name:"nguiHighlight"})],e)}(),b=function(){function e(){}return e.toLog=function(e){var t=this.LOG_LEVELS[this.logLevel];return this.LOG_LEVELS[e]>t},e.setLogLevel=function(e){e=e.toUpperCase();var t=Object.keys(this.LOG_LEVELS);t.indexOf(e)>-1?(window&&window.sessionStorage&&window.sessionStorage.setItem("konsole.LOG_LEVEL",e),this.logLevel=e):console.error("Error, invalid logLevel, it must be one of "+t)},e.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("DEBUG")&&console.debug.apply(console,arguments)},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("LOG")&&console.log.apply(console,arguments)},e.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("INFO")&&console.info.apply(console,arguments)},e.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("WARN")&&console.warn.apply(console,arguments)},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("ERROR")&&console.error.apply(console,arguments)},e.LOG_LEVELS={ALL:parseInt("00000",2),DEBUG:parseInt("00001",2),LOG:parseInt("00010",2),INFO:parseInt("00100",2),WARN:parseInt("01000",2),ERROR:parseInt("10000",2),NONE:parseInt("11111",2)},e.logLevel="INFO",e}(),O=function(){function e(){}return e=s([t.NgModule({imports:[n.CommonModule],declarations:[I],exports:[I],providers:[d]})],e)}(),C=function(){function e(){}return e=s([t.NgModule({imports:[u,E,O],exports:[u,E,O]})],e)}();e.DynamicComponentService=d,e.NguiAutocompleteComponent=f,e.NguiCommonModule=C,e.NguiHighlightPipe=I,e.NguiInviewComponent=c,e.NguiInviewDirective=a,e.NguiInviewModule=u,e.NguiInviewPageComponent=h,e.NguiListDirective=y,e.NguiListItemDirective=w,e.NguiListModule=E,e.NguiUtilsModule=O,e.NguiVirtualListComponent=m,e.fireEvent=l,e.konsole=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngui-common.umd.min.js.map
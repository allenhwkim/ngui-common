!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("rxjs")):"function"==typeof define&&define.amd?define("@ngui/common",["exports","@angular/core","@angular/common","rxjs"],e):e(((t=t||self).ngui=t.ngui||{},t.ngui.common={}),t.ng.core,t.ng.common,t.rxjs)}(this,(function(t,e,n,i){"use strict";var o=function(){function t(t,n){this.element=t,this.platformId=n,this.observerOptions={threshold:[.1,.2,.3,.4,.5,.6,.7,.8]},this.blurEnabled=!0,this.inview=new e.EventEmitter,this.notInview=new e.EventEmitter,this.isInview=!1,this.once80PctVisible=!1}return t.prototype.ngOnInit=function(){this.options&&(this.observerOptions=this.options),n.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.observerOptions),this.observer.observe(this.element.nativeElement))},t.prototype.ngOnDestroy=function(){this.observer.disconnect()},t.prototype.handleIntersect=function(t){var e=this;t.forEach((function(t){t.isIntersecting?(e.isInview=!0,e.defaultInviewHandler(t),e.inview.emit(t)):e.notInview.emit(t)}))},t.prototype.defaultInviewHandler=function(t){if(this.blurEnabled&&!this.once80PctVisible&&!this.inview.observers.length)if(t.intersectionRatio<.8){var e=1.25*t.intersectionRatio,n="blur("+(20-4*Math.floor(10*t.intersectionRatio))+"px)";Object.assign(t.target.style,{opacity:e,filter:n})}else t.target.style.opacity=1,t.target.style.filter="unset",this.once80PctVisible=!0},t}();o.decorators=[{type:e.Component,args:[{selector:"ngui-inview",template:'\n        <ng-container *ngIf="isInview" [ngTemplateOutlet]="template">\n        </ng-container>\n    ',styles:[":host {display: block;}"]}]}],o.ctorParameters=function(){return[{type:e.ElementRef},{type:void 0,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]},o.propDecorators={template:[{type:e.ContentChild,args:[e.TemplateRef,{static:!0}]}],observerOptions:[{type:e.Input}],options:[{type:e.Input}],blurEnabled:[{type:e.Input}],inview:[{type:e.Output}],notInview:[{type:e.Output}]};var s=function(){function t(t,n){this.element=t,this.platformId=n,this.observerOptions={threshold:[.1,.2,.3,.4,.5,.6,.7,.8]},this.nguiInview=new e.EventEmitter,this.nguiOutview=new e.EventEmitter}return t.prototype.ngOnInit=function(){this.options&&(this.observerOptions=this.options),n.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.observerOptions),this.observer.observe(this.element.nativeElement))},t.prototype.ngOnDestroy=function(){n.isPlatformBrowser(this.platformId)&&this.observer&&this.observer.disconnect()},t.prototype.handleIntersect=function(t){var e=this;t.forEach((function(t){t.isIntersecting?e.nguiInview.emit(t):e.nguiOutview.emit(t)}))},t}();s.decorators=[{type:e.Directive,args:[{selector:"[nguiInview], [nguiOutview]"}]}],s.ctorParameters=function(){return[{type:e.ElementRef},{type:void 0,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]},s.propDecorators={observerOptions:[{type:e.Input}],options:[{type:e.Input}],nguiInview:[{type:e.Output}],nguiOutview:[{type:e.Output}]};var r=function(){};r.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],declarations:[o,s],exports:[o,s]}]}];
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};Object.create;function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,s=n.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return r}function c(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}Object.create;function u(t,e,n){var i;return void 0===n&&(n={}),"click"===e||e.match(/^mouse/)?i=new MouseEvent(e,n):e.match(/^key/)?i=new KeyboardEvent(e,n):e.match(/^touch/)&&(i=new TouchEvent(e,n)),t.dispatchEvent(i)}var l=function(){function t(t){this.factoryResolver=t}return t.prototype.createComponent=function(t,e){return this.rootViewContainer=e||this.rootViewContainer,this.factoryResolver.resolveComponentFactory(t).create(this.rootViewContainer.parentInjector)},t.prototype.insertComponent=function(t){var e="ngui-dyn-"+(Math.floor(Math.random()*Math.pow(10,7))+Math.pow(10,6));return t.location.nativeElement.setAttribute("id",e),t.instance.id=e,this.rootViewContainer.insert(t.hostView),t.instance},t}();l.decorators=[{type:e.Injectable}],l.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[e.ComponentFactoryResolver]}]}]};var h=function(){function t(t,e,n){this.element=t,this.renderer=e,this.cdRef=n,this.outView=!1,this.itemsBackup=[]}return t.prototype.restoreItems=function(){this.outView&&(this.outView=!1,this.items=Array.from(this.itemsBackup||[]),this.itemsBackup=void 0,this.renderer.setStyle(this.contentsEl,"height",void 0),this.cdRef.detectChanges())},t.prototype.ngOnInit=function(){this.contentsEl=this.element.nativeElement.querySelector(".inview-page.contents")},t.prototype.ngOnDestroy=function(){console.log("NguiInviewPageComponent.ngOnDestroy() is called"),this.destroyed=!0},t.prototype.emptyItems=function(){if(this.items&&this.contentsEl&&!this.outView){var t=this.element.nativeElement.getBoundingClientRect().height;this.renderer.setStyle(this.contentsEl,"height",t+"px"),this.outView=!0,this.itemsBackup=Array.from(this.items||[]),this.items=void 0,this.destroyed||this.cdRef.detectChanges()}},t.prototype.setItems=function(t){this.destroyed||(console.log("NguiInviewPageComponent.setItems() is called with",t),this.items=t,this.cdRef.detectChanges())},t}();h.decorators=[{type:e.Component,args:[{selector:"ngui-inview-page",template:'\n    <div class="inview-page contents"\n      (nguiInview)="restoreItems()"\n      (nguiOutview)="emptyItems()">\n      \x3c!-- add blank ngui-list-item by condition  --\x3e\n      \x3c!-- no match found ngui-list-item by condition --\x3e\n      <ng-container\n        [ngTemplateOutlet]="template||defaultTemplate"\n        [ngTemplateOutletContext]="{items: items, outView: outView}">\n      </ng-container>\n      <div *ngIf="outView">{{ itemsBackup.length }} items hidden</div>\n    </div>\n\n    <ng-template #defaultTemplate>\n      <div *ngIf="!items"> Error: requires [items] </div>\n      <div *ngIf="!template"> Error: requires &lt;ng-template></div>\n    </ng-template>\n  ',styles:["\n    :host {display: block}\n  "]}]}],h.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.ChangeDetectorRef}]},h.propDecorators={template:[{type:e.ContentChild,args:[e.TemplateRef,{static:!0}]}],items:[{type:e.Input}]};var d=function(){function t(t,n,i,o){this.renderer=t,this.element=n,this.dynamicComponentService=i,this.cdr=o,this.selected=new e.EventEmitter,this.escaped=new e.EventEmitter,this.bottomInview=new e.EventEmitter,this._focused=!1,this.inviewPages=[]}return t.prototype.ngAfterViewInit=function(){this.template&&this.bottomInview.observers.length||console.error("<ngui-virtual-list> requires [template] and {bottomInview)")},t.prototype.addAnInviewPageToPages=function(){this.isListLoading?console.log("Already a page being inserted, skipping adding a page"):(this.isListLoading=!0,this.inviewPage=this.dynamicComponentService.createComponent(h,this.pagesRef),this.dynamicComponentService.insertComponent(this.inviewPage),this.inviewPage.instance.template=this.template,this.inviewPages.push(this.inviewPage),this.bottomInview.emit(this))},t.prototype.addList=function(t){this.isListLoading=!1,console.log(">>>>>> NguiVirtualListComponent.addList() is called()"),this.inviewPage.instance.setItems(t)},t}();d.decorators=[{type:e.Component,args:[{selector:"ngui-virtual-list",template:'\n    <div class="ngui-virtual-list"\n      (focus)="_focused = true"\n      (click)="_focused = true">\n      \x3c!-- hold multiple <ngui-inview-page> --\x3e\n      <div #pages></div>\n      \x3c!-- insert <ngui-inview-page> into #pages --\x3e\n    </div>\n    <ngui-inview (inview)="addAnInviewPageToPages()"></ngui-inview>\n  ',styles:["\n    :host {display: block}\n  "]}]}],d.ctorParameters=function(){return[{type:e.Renderer2},{type:e.ElementRef},{type:l},{type:e.ChangeDetectorRef}]},d.propDecorators={pagesRef:[{type:e.ViewChild,args:["pages",{read:e.ViewContainerRef}]}],template:[{type:e.ContentChild,args:[e.TemplateRef]}],selected:[{type:e.Output}],escaped:[{type:e.Output}],bottomInview:[{type:e.Output}]};var m=function(){this.html="No Match Found"},g=function(){this.html="Select"},v=function(t){function e(){var e=t.apply(this,c(arguments))||this;return e.minInputChars=1,e.blankOption="Select One",e.noMatchItem="No Match Found",e._focused={input:!1,listItem:!1},e}return function(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),Object.defineProperty(e.prototype,"isReady",{get:function(){var t=this._selectedFromList||this._escapedFromList,e=this._focused.input||this._focused.listItem,n=this.inputEl.value.length>=this.minInputChars;return!t&&e&&n},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){this.inputEl=document.querySelector("#"+this.for),this.positionThisUnderInputEl(),i.fromEvent(this.inputEl,"keyup").subscribe(this.onInputElKeyup.bind(this)),this.inputEl.addEventListener("focus",this.onInputElFocused.bind(this)),this.inputEl.addEventListener("blur",this.onInputElBlurred.bind(this)),this.selected.subscribe(this.onSelected.bind(this)),this.escaped.subscribe(this.onEscaped.bind(this))},e.prototype.onSelected=function(t){this._selectedFromList=!0,this.inputEl.focus(),this._lastSelected=t,this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onSelected() is called",t)},e.prototype.onEscaped=function(){this._escapedFromList=!0,this.inputEl.focus(),this._lastSelected||(this.inputEl.value=this._orgInputValue),this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onEscaped() is called")},e.prototype.onInputElFocused=function(t){console.log("NguiAutoCompleteComponent.onInputElFocused() is called",t),this.isListLoading=!1,void 0===this._orgInputValue&&(this._orgInputValue=this.inputEl.value),this._prevInputValue=this.inputEl.value,this.setFocused("input",!0)},e.prototype.onInputElBlurred=function(){this.setFocused("input",!1)},e.prototype.clearList=function(){this.inviewPages.forEach((function(t){t.destroy()})),this.inviewPages=[]},e.prototype.onInputElKeyup=function(t){console.log("NguiAutoCompleteComponent.onInputKeyup() is called",t.key);var e=this.element.nativeElement.querySelector("ngui-list-item");"Enter"===t.key||"Escape"===t.key?e?u(e,"keyup",{key:t.key}):this.onEscaped():"ArrowDown"!==t.key&&"ArrowRight"!==t.key||!e?"ArrowUp"===t.key||"ArrowLeft"===t.key||this.inputEl.value.length>=this.minInputChars&&(this._selectedFromList=!1,this._escapedFromList=!1,this.addAutocompleteList()):e.focus()},e.prototype.addAutocompleteList=function(){var t=this;this.isReady&&(clearTimeout(this._acTimer),this._acTimer=setTimeout((function(){t.isListLoading=!1,t._prevInputValue=t.inputEl.value,t._escapedFromList=!1,t._selectedFromList=!1,t.clearList(),t.addAnInviewPageToPages()}),200))},e.prototype.addMorePages=function(){this.inviewPages.length&&this.addAnInviewPageToPages()},e.prototype.setFocused=function(t,e){var n=this;e?(clearTimeout(this._focusTimer),this._focused={input:!1,listItem:!1},this._focused[t]=!0):this._focusTimer=setTimeout((function(){n._focused[t]=!1,n.cdr.detectChanges()}),100)},e.prototype.positionThisUnderInputEl=function(){var t=this.element.nativeElement,e=this.inputEl.getBoundingClientRect(),n=e.top+e.height+window.scrollY;this.renderer.setStyle(t,"left",e.left+"px"),this.renderer.setStyle(t,"top",n+"px"),this.renderer.setStyle(t,"minWidth",e.width+"px")},e.prototype.addList=function(t){var e;console.log(">>>>>> NguiAutocompleteComponent.addList() is called()"),this.isListLoading=!1;var n={};1===this.inviewPages.length&&(!this.noMatchItem||t&&0!==t.length?this.blankOption&&((n=new g).html=this.blankOption):(e=new m,n.html=this.noMatchItem));var i=[].concat(e,n,t).filter((function(t){return t}));this.inviewPage.instance.setItems(i),this.cdr.detectChanges()},e}(d);v.decorators=[{type:e.Component,args:[{selector:"ngui-autocomplete",template:'\n    <ng-container *ngIf="isReady">\n      <div class="ngui-autocomplete">\n        <div #pages></div>\n      </div>\n      <ngui-inview (inview)="addMorePages()"></ngui-inview>\n    </ng-container>\n  ',styles:["\n    :host {position: absolute; background-color: #fff; max-height: 300px; overflow: auto}\n    .ngui-autocomplete { border: 1px solid #ccc; padding: 4px }\n  "]}]}],v.propDecorators={for:[{type:e.Input}],minInputChars:[{type:e.Input}],blankOption:[{type:e.Input}],noMatchItem:[{type:e.Input}],template:[{type:e.ContentChild,args:[e.TemplateRef]}]};var f=function(t){this.element=t,this.selected=new e.EventEmitter,this.escaped=new e.EventEmitter};f.decorators=[{type:e.Directive,args:[{selector:"ngui-list"}]}],f.ctorParameters=function(){return[{type:e.ElementRef}]},f.propDecorators={selected:[{type:e.Output}],escaped:[{type:e.Output}]};var y=function(){function t(t,e,n,i,o,s){this.el=t,this.renderer=e,this.viewContainer=n,this.listDirective=i,this.virtualListComponent=o,this.autocompleteComponent=s}return t.prototype.ngOnInit=function(){if(this.renderer.setAttribute(this.el.nativeElement,"tabindex","0"),this.parentListComp=this.listDirective||this.virtualListComponent||this.autocompleteComponent,!this.parentListComp)throw Error("ngui-list-item requires parent of ngui-list, ngui-virtual-list, or ngui-autocomplete.");(this.object instanceof g||this.object instanceof m)&&(this.viewContainer.clear(),this.el.nativeElement.innerHTML=this.object.html)},t.prototype.keydown=function(t){var e=this.el.nativeElement,n=t.which||t.keyCode,i=this.parentListComp.element.nativeElement,o=Array.from(i.querySelectorAll("ngui-list-item")),s=o.indexOf(e),r=o[s+1]||o[0],a=o[s-1]||o[o.length-1];switch(n){case 37:case 38:a.focus();break;case 39:case 40:r.focus()}},t.prototype.keyup=function(t){switch(t.key){case"Enter":this.parentListComp.selected.emit(this.object);break;case"Escape":this.parentListComp.escaped.emit()}},t.prototype.mousedown=function(){this.parentListComp.selected.emit(this.object)},t.prototype.focused=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!0)},t.prototype.blurred=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!1)},t}();y.decorators=[{type:e.Directive,args:[{selector:"ngui-list-item"}]}],y.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.ViewContainerRef},{type:f,decorators:[{type:e.Optional},{type:e.Host}]},{type:d,decorators:[{type:e.Optional},{type:e.Host}]},{type:v,decorators:[{type:e.Optional},{type:e.Host}]}]},y.propDecorators={object:[{type:e.Input,args:["item"]}],keydown:[{type:e.HostListener,args:["keydown",["$event"]]}],keyup:[{type:e.HostListener,args:["keyup",["$event"]]}],mousedown:[{type:e.HostListener,args:["click",["$event"]]}],focused:[{type:e.HostListener,args:["focus",["$event"]]}],blurred:[{type:e.HostListener,args:["blur",["$event"]]}]};var w=function(){};w.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule,r],declarations:[v,h,f,y,d],exports:[v,h,f,y,d],entryComponents:[h]}]}];var I=function(){function t(){}return t.prototype.transform=function(t,e){var n=t;if(e){var i=new RegExp(e,"ig");n=t.replace(i,(function(t){return'<span class="ngui-highlight">'+t+"</span>"}))}return n},t}();I.decorators=[{type:e.Pipe,args:[{name:"nguiHighlight"}]}];var E=function(){function t(){}return t.toLog=function(t){var e=this.LOG_LEVELS[this.logLevel];return this.LOG_LEVELS[t]>e},t.setLogLevel=function(t){t=t.toUpperCase();var e=Object.keys(this.LOG_LEVELS);e.indexOf(t)>-1?(window&&window.sessionStorage&&window.sessionStorage.setItem("konsole.LOG_LEVEL",t),this.logLevel=t):console.error("Error, invalid logLevel, it must be one of "+e)},t.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("DEBUG")&&console.debug.apply(console,arguments)},t.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("LOG")&&console.log.apply(console,arguments)},t.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("INFO")&&console.info.apply(console,arguments)},t.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("WARN")&&console.warn.apply(console,arguments)},t.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("ERROR")&&console.error.apply(console,arguments)},t}();E.LOG_LEVELS={ALL:parseInt("00000",2),DEBUG:parseInt("00001",2),LOG:parseInt("00010",2),INFO:parseInt("00100",2),WARN:parseInt("01000",2),ERROR:parseInt("10000",2),NONE:parseInt("11111",2)},E.logLevel="INFO";var b=function(){};b.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],declarations:[I],exports:[I],providers:[l]}]}];var L=function(){};L.decorators=[{type:e.NgModule,args:[{imports:[r,w,b],exports:[r,w,b]}]}],t.DynamicComponentService=l,t.NguiAutocompleteComponent=v,t.NguiCommonModule=L,t.NguiHighlightPipe=I,t.NguiInviewComponent=o,t.NguiInviewDirective=s,t.NguiInviewModule=r,t.NguiInviewPageComponent=h,t.NguiListDirective=f,t.NguiListItemDirective=y,t.NguiListModule=w,t.NguiUtilsModule=b,t.NguiVirtualListComponent=d,t.fireEvent=u,t.konsole=E,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngui-common.umd.min.js.map